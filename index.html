<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parsahutaon Palito PK2</title>
  <meta name="description" content="Organisasi Parsahutaon Palito PK2 | Budaya Batak, Keagamaan, Sosial" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --red:#EF4444;
      --dark:black;
      --light:#ffffff;
    }
    html, body { height: 100%; }
    body { font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    /* Subtle animated gradient background */
    .bg-stripes {
      background: radial-gradient(1200px 500px at -10% -20%, rgba(239,68,68,0.18), transparent 60%),
                  radial-gradient(1200px 500px at 110% 130%, rgba(239,68,68,0.20), transparent 60%),
                  linear-gradient(180deg, #0a0a0a 0%, #0e0e0e 100%);
    }
    /* Ulos-inspired divider */
    .ulos-divider {
      background-image:
        linear-gradient(45deg, rgba(239,68,68,0.8) 25%, transparent 25%),
        linear-gradient(-45deg, rgba(239,68,68,0.8) 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, rgba(239,68,68,0.8) 75%),
        linear-gradient(-45deg, transparent 75%, rgba(239,68,68,0.8) 75%);
      background-size: 22px 22px;
      background-position: 0 0, 0 11px, 11px -11px, -11px 0;
      height: 10px;
    }
    /* Smooth fade */
    .fade-in { animation: fade .5s ease forwards; opacity: 0; }
    @keyframes fade { to { opacity: 1; } }

    /* Hide admin controls by default; JS will toggle */
    .admin-only.hidden { display: none !important; }
    /* Gallery viewer */
    .viewer-open { overflow: hidden; }
  </style>
</head>
<body class="bg-stripes text-white">
  <!-- Top Alert for Demo Mode Info (appears only when admin is on) -->
  <div id="adminBanner" class="admin-only hidden w-full bg-red-600/20 backdrop-blur px-4 py-2 text-sm text-red-100 border-b border-red-500/40">
    Mode Admin (Demo) aktif. Perubahan disimpan di perangkat ini saja dan tidak meminta kata sandi.
  </div>

  <!-- Header -->
  <header class="max-w-7xl mx-auto px-4 md:px-8 pt-8 pb-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <!-- Logo -->
        <div class="relative">
          <div class="w-16 h-16 rounded-full bg-black/70 border border-red-500/60 flex items-center justify-center overflow-hidden shadow-lg">
            <img id="orgLogo" alt="Logo" class="w-full h-full object-cover hidden" />
            <!-- Placeholder initials -->
            <span id="logoInitials" class="font-extrabold text-xl text-red-400">PP</span>
          </div>
          <button id="btnUploadLogo" class="admin-only hidden absolute -bottom-2 left-1/2 -translate-x-1/2 text-[11px] bg-red-600 hover:bg-red-500 text-white px-2 py-0.5 rounded-full border border-red-400/60 shadow">
            Ubah Logo
          </button>
          <input id="inputLogo" type="file" accept="image/*" class="hidden" />
        </div>
        <!-- Title -->
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">
            Parsahutaon Palito PK2
          </h1>
          <p class="text-red-300/90 text-sm md:text-base">Budaya Batak • Keagamaan • Sosial</p>
          <div class="flex flex-wrap gap-3 mt-2 text-xs md:text-sm text-white/80">
            <span class="inline-flex items-center gap-1">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M12 2C8 2 5 5.1 5 9.3c0 5.6 7 12.4 7 12.4s7-6.8 7-12.4C19 5.1 16 2 12 2z" stroke="currentColor" stroke-width="1.5"></path><circle cx="12" cy="9" r="2.5" stroke="currentColor" stroke-width="1.5"></circle></svg>
              Perumahan Pesona Kahuripan 2, Cikahuripan
            </span>
            <a href="mailto:palitoopk2@gmail.com" class="inline-flex items-center gap-1 hover:text-red-300 transition-colors">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M3 5h18v14H3z" stroke="currentColor" stroke-width="1.5"></path><path d="M3 7l9 6 9-6" stroke="currentColor" stroke-width="1.5"></path></svg>
              palitoopk2@gmail.com
            </a>
          </div>
        </div>
      </div>
      <!-- Admin buttons -->
      <div class="flex items-center gap-2">
        <button id="btnAdmin" class="text-xs md:text-sm bg-white/10 hover:bg-white/15 text-white px-3 py-2 rounded-lg border border-white/15">
          Masuk Admin (Demo)
        </button>
        <button id="btnLogout" class="admin-only hidden text-xs md:text-sm bg-white/10 hover:bg-white/15 text-white px-3 py-2 rounded-lg border border-white/15">
          Keluar
        </button>
      </div>
    </div>
  </header>

  <!-- Hero / Cover -->
  <section class="relative max-w-7xl mx-auto px-4 md:px-8">
    <div class="relative rounded-2xl overflow-hidden border border-red-500/30 shadow-xl">
      <div id="coverWrap" class="relative h-[220px] md:h-[360px] bg-gradient-to-br from-red-900/40 to-black">
        <img id="coverImage" class="absolute inset-0 w-full h-full object-cover hidden" alt="Foto Halaman" />
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
        <div class="absolute bottom-4 left-4 right-4 md:bottom-6 md:left-6 md:right-6">
          <div class="inline-flex items-center gap-2 bg-black/60 px-4 py-2 rounded-full border border-white/10 text-white/90 text-sm">
            <span class="inline-block w-2 h-2 rounded-full bg-red-400"></span>
            Komunitas Parsahutaon Palito PK2
          </div>
          <h2 class="mt-3 text-2xl md:text-4xl font-bold">Merajut Persaudaraan, Iman, dan Budaya</h2>
          <p class="mt-1 text-white/80 text-sm md:text-base">Bersama dalam pelayanan, kebersamaan, dan pelestarian budaya Batak.</p>
        </div>
      </div>
      <div class="ulos-divider"></div>
      <div class="p-4 md:p-6 flex items-center justify-between">
        <div class="text-white/80 text-sm">Foto halaman dapat diubah oleh admin.</div>
        <div class="flex items-center gap-2">
          <button id="btnUploadCover" class="admin-only hidden bg-red-600 hover:bg-red-500 px-3 py-2 rounded-lg text-sm border border-red-400/60">Ubah Foto Halaman</button>
          <input id="inputCover" type="file" accept="image/*" class="hidden" />
        </div>
      </div>
    </div>
  </section>

  <!-- Nav -->
  <nav class="max-w-7xl mx-auto px-4 md:px-8 mt-8">
    <div class="flex flex-wrap gap-3">
      <a href="#pengurus" class="px-4 py-2 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white text-sm">Kepengurusan</a>
      <a href="#program" class="px-4 py-2 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white text-sm">Program</a>
      <a href="#galeri" class="px-4 py-2 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white text-sm">Galeri</a>
      <a href="#dokumen" class="px-4 py-2 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white text-sm">Dokumen</a>
    </div>
  </nav>

  <!-- Kepengurusan -->
  <section id="pengurus" class="max-w-7xl mx-auto px-4 md:px-8 mt-12">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl md:text-2xl font-bold">Struktur Kepengurusan</h3>
      <div class="flex items-center gap-2">
        <button id="btnTambahPengurus" class="admin-only hidden bg-red-600 hover:bg-red-500 px-3 py-2 rounded-lg text-sm border border-red-400/60">Tambah Pengurus</button>
      </div>
    </div>
    <p class="text-white/70 text-sm mb-4">Nama-nama dapat ditambah atau diedit oleh admin.</p>
    <div id="listPengurus" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"></div>
  </section>

  <!-- Program -->
  <section id="program" class="max-w-7xl mx-auto px-4 md:px-8 mt-12">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl md:text-2xl font-bold">Program Kegiatan</h3>
      <div class="flex items-center gap-2">
        <button id="btnTambahProgram" class="admin-only hidden bg-red-600 hover:bg-red-500 px-3 py-2 rounded-lg text-sm border border-red-400/60">Tambah Program</button>
      </div>
    </div>
    <div class="grid md:grid-cols-2 gap-6">
      <div class="bg-white/5 border border-white/10 rounded-xl p-4">
        <h4 class="font-semibold text-red-300 mb-3">Bulanan</h4>
        <ul id="programBulanan" class="space-y-3"></ul>
      </div>
      <div class="bg-white/5 border border-white/10 rounded-xl p-4">
        <h4 class="font-semibold text-red-300 mb-3">Tahunan</h4>
        <ul id="programTahunan" class="space-y-3"></ul>
      </div>
    </div>
  </section>

  <!-- Galeri -->
  <section id="galeri" class="max-w-7xl mx-auto px-4 md:px-8 mt-12">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl md:text-2xl font-bold">Galeri Kegiatan</h3>
      <div class="flex items-center gap-2">
        <button id="btnTambahFoto" class="admin-only hidden bg-red-600 hover:bg-red-500 px-3 py-2 rounded-lg text-sm border border-red-400/60">Tambah Foto</button>
        <input id="inputFotoGaleri" type="file" multiple accept="image/*" class="hidden" />
      </div>
    </div>
    <p class="text-white/70 text-sm mb-4">Satu album berisi foto-foto kegiatan.</p>
    <div id="gridGaleri" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
  </section>

  <!-- Dokumen -->
  <section id="dokumen" class="max-w-7xl mx-auto px-4 md:px-8 mt-12 mb-16">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl md:text-2xl font-bold">Dokumen Organisasi</h3>
      <div class="flex items-center gap-2">
        <button id="btnUploadDok" class="admin-only hidden bg-red-600 hover:bg-red-500 px-3 py-2 rounded-lg text-sm border border-red-400/60">Unggah Dokumen</button>
        <input id="inputDokumen" type="file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt" class="hidden" />
      </div>
    </div>
    <p class="text-white/70 text-sm mb-4">AD/ART, surat keputusan, dan lainnya. Dapat diunduh pengunjung.</p>
    <ul id="listDokumen" class="space-y-3"></ul>
  </section>

  <!-- Footer -->
  <footer class="border-t border-white/10">
    <div class="max-w-7xl mx-auto px-4 md:px-8 py-8">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
        <div>
          <div class="font-semibold">Parsahutaon Palito PK2</div>
          <div class="text-white/70 text-sm">
            Perumahan Pesona Kahuripan 2, Cikahuripan •
            <a class="hover:text-red-300" href="mailto:palitoopk2@gmail.com">palitoopk2@gmail.com</a>
          </div>
        </div>
        <div class="text-white/60 text-sm">
          © <span id="year"></span> Parsahutaon Palito PK2 • Dibuat dengan cinta
        </div>
      </div>
    </div>
  </footer>

  <!-- Admin Modal (Demo) -->
  <div id="modalAdmin" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center p-4 hidden z-50">
    <div class="max-w-md w-full bg-neutral-900 rounded-2xl border border-white/10 p-5">
      <div class="flex items-center justify-between mb-3">
        <h4 class="font-semibold">Masuk Admin (Demo)</h4>
        <button id="closeAdminModal" class="text-white/70 hover:text-white">✕</button>
      </div>
      <p class="text-white/70 text-sm mb-3">
        Hanya gunakan email terdaftar. Tidak ada kata sandi. Ini adalah tampilan demo yang berjalan di perangkat ini saja.
      </p>
      <label class="block text-sm mb-1">Email Admin</label>
      <input id="adminEmail" type="email" placeholder="contoh: palitoopk2@gmail.com" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
      <div class="flex items-center justify-end gap-2 mt-4">
        <button id="btnAdminBatal" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/10">Batal</button>
        <button id="btnAdminMasuk" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 border border-red-400/60">Masuk</button>
      </div>
      <div id="adminMsg" class="text-sm text-red-300 mt-3 hidden">Email tidak cocok. Gunakan email terdaftar.</div>
    </div>
  </div>

  <!-- Reusable Small Modal -->
  <div id="modalBase" class="fixed inset-0 bg-black/60 backdrop-blur-sm items-center justify-center p-4 hidden z-40">
    <div class="max-w-md w-full bg-neutral-900 rounded-2xl border border-white/10 p-5">
      <div class="flex items-center justify-between mb-3">
        <h4 id="modalTitle" class="font-semibold">Form</h4>
        <button id="closeBaseModal" class="text-white/70 hover:text-white">✕</button>
      </div>
      <div id="modalContent" class="space-y-3"></div>
      <div class="flex items-center justify-end gap-2 mt-4">
        <button id="modalCancel" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 border border-white/10">Batal</button>
        <button id="modalSave" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 border border-red-400/60">Simpan</button>
      </div>
    </div>
  </div>

  <!-- Viewer for Gallery -->
  <div id="viewer" class="fixed inset-0 hidden items-center justify-center bg-black/90 z-50">
    <button id="viewerClose" class="absolute top-4 right-4 bg-white/10 border border-white/15 text-white rounded-full px-3 py-2">Tutup</button>
    <button id="viewerPrev" class="absolute left-4 md:left-8 bg-white/10 border border-white/15 text-white rounded-full px-3 py-2">‹</button>
    <button id="viewerNext" class="absolute right-4 md:right-8 bg-white/10 border border-white/15 text-white rounded-full px-3 py-2">›</button>
    <img id="viewerImg" class="max-h-[82vh] max-w-[92vw] rounded-xl border border-white/10 shadow-2xl" alt="Foto" />
  </div>

  <script>
    // --- Data & State ---
    const ADMIN_EMAIL = "palitoopk2@gmail.com";
    const STORAGE_KEY = "parsahutaon_palito_pk2_site";

    const $ = (sel, parent=document) => parent.querySelector(sel);
    const $$ = (sel, parent=document) => Array.from(parent.querySelectorAll(sel));
    const byId = id => document.getElementById(id);

    function loadData() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) return JSON.parse(saved);
      } catch {}
      // Default data including structure names provided
      return {
        logo: null,
        cover: null,
        pengurus: [
          // Dewan Penasehat
          { id: uid(), name: "Amang R. Simanjuntak (op. Sena)", role: "Dewan Penasehat", photo: null },
          { id: uid(), name: "Amang B. Manalu", role: "Dewan Penasehat", photo: null },
          { id: uid(), name: "Amang A. Purba", role: "Dewan Penasehat", photo: null },
          { id: uid(), name: "Amang S. Naenggolan", role: "Dewan Penasehat", photo: null },

          // Inti
          { id: uid(), name: "R. Simanjuntak", role: "Ketua", photo: null },
          { id: uid(), name: "Amang A. Manalu", role: "Wakil Ketua", photo: null },
          { id: uid(), name: "Amang I. Siagian", role: "Sekretaris", photo: null },
          { id: uid(), name: "Inang Ny. R. Aritonang / br. Sitorus", role: "Bendahara 1", photo: null },
          { id: uid(), name: "Inang Ny. H. Simbolon / br. Sinurat", role: "Bendahara 2", photo: null },

          // Seksi Rohani
          { id: uid(), name: "Inang Ny. M.S / br. Batubara", role: "Seksi Rohani", photo: null },
          { id: uid(), name: "Inang Ny. S. Naenggolan / br. Purba", role: "Seksi Rohani", photo: null },

          // Seksi Sosial
          { id: uid(), name: "Inang Ny. I. Siagian / br. Panjaitan", role: "Seksi Sosial", photo: null },
          { id: uid(), name: "Inang Ny. A. Purba / br. Sitohang", role: "Seksi Sosial", photo: null },

          // Seksi Adat
          { id: uid(), name: "Amang T. Nababan", role: "Seksi Adat", photo: null },

          // Humas
          { id: uid(), name: "Amang H. Simangusong", role: "Humas", photo: null },
          { id: uid(), name: "Amang P. Situmorang", role: "Humas", photo: null },
        ],
        program: {
          bulanan: [
            { id: uid(), title: "Arisan Bulanan", date: "" },
            { id: uid(), title: "Persekutuan Doa", date: "" },
          ],
          tahunan: [
            { id: uid(), title: "Natal", date: "" },
            { id: uid(), title: "Bona Taon", date: "" },
          ]
        },
        galeri: [],
        dokumen: []
      };
    }

    function saveData() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(DATA));
      } catch (e) {
        alert("Penyimpanan penuh. Mohon hapus beberapa foto/dokumen atau gunakan ukuran lebih kecil.");
      }
    }

    function uid() { return Math.random().toString(36).slice(2) + Date.now().toString(36); }

    let DATA = loadData();
    let isAdmin = localStorage.getItem("admin_demo") === "true";

    // --- Admin Gate ---
    function applyAdminVisibility() {
      $$(".admin-only").forEach(el => el.classList.toggle("hidden", !isAdmin));
      byId("adminBanner").classList.toggle("hidden", !isAdmin);
    }

    function openAdminModal() {
      byId("modalAdmin").classList.remove("hidden");
      byId("adminEmail").value = "";
      byId("adminMsg").classList.add("hidden");
    }
    function closeAdminModal() {
      byId("modalAdmin").classList.add("hidden");
    }

    // --- Renderers ---
    function renderHeader() {
      const logoImg = byId("orgLogo");
      const initials = byId("logoInitials");
      if (DATA.logo) {
        logoImg.src = DATA.logo;
        logoImg.classList.remove("hidden");
        initials.classList.add("hidden");
      } else {
        logoImg.classList.add("hidden");
        initials.classList.remove("hidden");
      }
      const cover = byId("coverImage");
      if (DATA.cover) {
        cover.src = DATA.cover;
        cover.classList.remove("hidden");
      } else {
        cover.classList.add("hidden");
      }
    }

    function renderPengurus() {
      const wrap = byId("listPengurus");
      wrap.innerHTML = "";
      DATA.pengurus.forEach(p => {
        const card = document.createElement("div");
        card.className = "bg-white/5 border border-white/10 rounded-xl p-4 flex gap-4 items-center";
        card.innerHTML = `
          <div class="w-16 h-16 rounded-xl border border-white/10 overflow-hidden bg-black/40 flex-shrink-0 flex items-center justify-center">
            ${p.photo ? `<img src="${p.photo}" alt="${p.name}" class="w-full h-full object-cover">` : `<span class="text-red-300 font-semibold">${initialsFromName(p.name)}</span>`}
          </div>
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-3">
              <div class="truncate">
                <div class="font-semibold">${p.name}</div>
                <div class="text-white/70 text-sm">${p.role}</div>
              </div>
              <div class="admin-only hidden flex items-center gap-2">
                <button data-act="foto" data-id="${p.id}" class="text-xs bg-white/10 hover:bg-white/15 border border-white/10 px-2 py-1 rounded">Foto</button>
                <button data-act="edit" data-id="${p.id}" class="text-xs bg-white/10 hover:bg-white/15 border border-white/10 px-2 py-1 rounded">Edit</button>
                <button data-act="hapus" data-id="${p.id}" class="text-xs bg-red-600 hover:bg-red-500 border border-red-400/60 px-2 py-1 rounded">Hapus</button>
              </div>
            </div>
          </div>
        `;
        // Bind admin actions
        card.querySelectorAll("[data-act]").forEach(btn => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            const act = btn.getAttribute("data-act");
            if (act === "edit") openPengurusModal(id);
            if (act === "hapus") hapusPengurus(id);
            if (act === "foto") unggahFotoPengurus(id);
          });
        });
        wrap.appendChild(card);
      });
      applyAdminVisibility();
    }

    function initialsFromName(name) {
      const parts = name.split(" ").filter(Boolean);
      const first = parts[0]?.[0] || "P";
      const last = parts[1]?.[0] || "P";
      return (first + last).toUpperCase();
    }

    function renderProgram() {
      const ulB = byId("programBulanan");
      const ulT = byId("programTahunan");
      ulB.innerHTML = "";
      ulT.innerHTML = "";
      const renderItem = (item, jenis) => {
        const li = document.createElement("li");
        li.className = "bg-black/30 border border-white/10 rounded-lg p-3 flex items-center justify-between";
        li.innerHTML = `
          <div>
            <div class="font-medium">${item.title}</div>
            <div class="text-white/60 text-xs">${item.date ? item.date : "Jadwal fleksibel"}</div>
          </div>
          <div class="admin-only hidden flex items-center gap-2">
            <button data-act="edit" data-id="${item.id}" data-t="${jenis}" class="text-xs bg-white/10 hover:bg-white/15 border border-white/10 px-2 py-1 rounded">Edit</button>
            <button data-act="hapus" data-id="${item.id}" data-t="${jenis}" class="text-xs bg-red-600 hover:bg-red-500 border border-red-400/60 px-2 py-1 rounded">Hapus</button>
          </div>
        `;
        li.querySelectorAll("[data-act]").forEach(btn => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            const t = btn.getAttribute("data-t");
            const act = btn.getAttribute("data-act");
            if (act === "edit") openProgramModal(id, t);
            if (act === "hapus") hapusProgram(id, t);
          });
        });
        return li;
      };
      DATA.program.bulanan.forEach(p => ulB.appendChild(renderItem(p, "bulanan")));
      DATA.program.tahunan.forEach(p => ulT.appendChild(renderItem(p, "tahunan")));
      applyAdminVisibility();
    }

    function renderGaleri() {
      const grid = byId("gridGaleri");
      grid.innerHTML = "";
      DATA.galeri.forEach((src, idx) => {
        const cell = document.createElement("div");
        cell.className = "group relative rounded-xl overflow-hidden border border-white/10 bg-black/30";
        cell.innerHTML = `
          <img src="${src}" alt="Kegiatan" class="w-full h-40 md:h-44 object-cover cursor-pointer">
          <div class="admin-only hidden absolute top-2 right-2 flex gap-2">
            <button data-i="${idx}" class="btnDelFoto text-xs bg-red-600 hover:bg-red-500 border border-red-400/60 px-2 py-1 rounded">Hapus</button>
          </div>
        `;
        cell.querySelector("img").addEventListener("click", () => openViewer(idx));
        const del = cell.querySelector(".btnDelFoto");
        if (del) del.addEventListener("click", (e) => { e.stopPropagation(); hapusFotoGaleri(idx); });
        grid.appendChild(cell);
      });
      applyAdminVisibility();
    }

    function renderDokumen() {
      const list = byId("listDokumen");
      list.innerHTML = "";
      DATA.dokumen.forEach(doc => {
        const li = document.createElement("li");
        li.className = "bg-white/5 border border-white/10 rounded-xl p-3 flex items-center justify-between";
        const sizeText = doc.size ? prettyBytes(doc.size) : "";
        const a = document.createElement("a");
        a.href = doc.dataUrl;
        a.download = doc.name || "dokumen";
        a.className = "flex items-center gap-3";
        a.innerHTML = `
          <span class="w-9 h-9 rounded-lg bg-black/40 border border-white/10 flex items-center justify-center">📄</span>
          <span>
            <span class="font-medium">${doc.name}</span>
            <span class="block text-xs text-white/60">${sizeText}</span>
          </span>
        `;
        const right = document.createElement("div");
        right.className = "flex items-center gap-2";
        const btnDownload = document.createElement("a");
        btnDownload.href = doc.dataUrl;
        btnDownload.download = doc.name || "dokumen";
        btnDownload.className = "bg-white/10 hover:bg-white/15 border border-white/10 px-3 py-1.5 rounded text-sm";
        btnDownload.textContent = "Unduh";

        const btnDelete = document.createElement("button");
        btnDelete.className = "admin-only hidden bg-red-600 hover:bg-red-500 border border-red-400/60 px-3 py-1.5 rounded text-sm";
        btnDelete.textContent = "Hapus";
        btnDelete.addEventListener("click", () => {
          if (confirm("Hapus dokumen ini?")) {
            DATA.dokumen = DATA.dokumen.filter(d => d.id !== doc.id);
            saveData();
            renderDokumen();
          }
        });

        li.appendChild(a);
        right.appendChild(btnDownload);
        right.appendChild(btnDelete);
        li.appendChild(right);
        list.appendChild(li);
      });
      applyAdminVisibility();
    }

    function prettyBytes(bytes) {
      if (!bytes) return "";
      const units = ['B','KB','MB','GB'];
      let i = 0;
      while (bytes >= 1024 && i < units.length-1) {
        bytes /= 1024; i++;
      }
      return bytes.toFixed(1) + " " + units[i];
    }

    function renderAll() {
      renderHeader();
      renderPengurus();
      renderProgram();
      renderGaleri();
      renderDokumen();
      applyAdminVisibility();
    }

    // --- Modals (Generic) ---
    function openBaseModal({title, contentHTML, onSave}) {
      byId("modalTitle").textContent = title || "Form";
      byId("modalContent").innerHTML = contentHTML || "";
      byId("modalBase").classList.remove("hidden");
      const saveBtn = byId("modalSave");
      const cancel = () => { byId("modalBase").classList.add("hidden"); };
      byId("modalCancel").onclick = cancel;
      byId("closeBaseModal").onclick = cancel;
      // remove previous listener
      const newSaveBtn = saveBtn.cloneNode(true);
      saveBtn.parentNode.replaceChild(newSaveBtn, saveBtn);
      newSaveBtn.onclick = () => { if (onSave) onSave(cancel); };
    }

    // --- Pengurus Actions ---
    function openPengurusModal(id=null) {
      const roles = ["Dewan Penasehat", "Ketua", "Wakil Ketua", "Sekretaris", "Bendahara 1", "Bendahara 2", "Seksi Rohani", "Seksi Sosial", "Seksi Adat", "Humas", "Lainnya"];
      const current = id ? DATA.pengurus.find(p => p.id === id) : { name:"", role:"", photo:null };
      openBaseModal({
        title: id ? "Edit Pengurus" : "Tambah Pengurus",
        contentHTML: `
          <label class="block text-sm mb-1">Nama</label>
          <input id="fNama" type="text" value="${escapeHtml(current.name)}" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
          <label class="block text-sm mt-3 mb-1">Jabatan</label>
          <select id="fRole" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
            ${roles.map(r => `<option ${r===current.role?'selected':''}>${r}</option>`).join("")}
          </select>
          <div class="mt-3">
            <label class="block text-sm mb-1">Foto (opsional)</label>
            <input id="fFoto" type="file" accept="image/*" class="w-full text-sm">
          </div>
        `,
        onSave: async (close) => {
          const name = byId("fNama").value.trim();
          const role = byId("fRole").value;
          if (!name) { alert("Nama wajib diisi."); return; }
          let photo = current.photo;
          const file = byId("fFoto").files[0];
          if (file) photo = await fileToDataURL(file);
          if (id) {
            Object.assign(current, { name, role, photo });
          } else {
            DATA.pengurus.push({ id: uid(), name, role, photo: photo || null });
          }
          saveData();
          renderPengurus();
          close();
        }
      });
    }

    function hapusPengurus(id) {
      if (!confirm("Hapus pengurus ini?")) return;
      DATA.pengurus = DATA.pengurus.filter(p => p.id !== id);
      saveData();
      renderPengurus();
    }

    async function unggahFotoPengurus(id) {
      // Create a quick invisible input for this action
      const input = document.createElement("input");
      input.type = "file"; input.accept = "image/*";
      input.onchange = async () => {
        const file = input.files[0];
        if (!file) return;
        const p = DATA.pengurus.find(x => x.id === id);
        p.photo = await fileToDataURL(file);
        saveData();
        renderPengurus();
      };
      input.click();
    }

    // --- Program Actions ---
    function openProgramModal(id=null, jenis="bulanan") {
      const cur = id ? DATA.program[jenis].find(p => p.id === id) : { title:"", date:"" };
      openBaseModal({
        title: id ? "Edit Program" : "Tambah Program",
        contentHTML: `
          <label class="block text-sm mb-1">Jenis</label>
          <select id="fJenis" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
            <option ${jenis==="bulanan"?'selected':''} value="bulanan">Bulanan</option>
            <option ${jenis==="tahunan"?'selected':''} value="tahunan">Tahunan</option>
          </select>
          <label class="block text-sm mt-3 mb-1">Nama Kegiatan</label>
          <input id="fJudul" type="text" value="${escapeHtml(cur.title)}" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
          <label class="block text-sm mt-3 mb-1">Jadwal (opsional)</label>
          <input id="fTanggal" type="text" placeholder="misal: setiap Sabtu pertama / 25 Des" value="${escapeHtml(cur.date || "")}" class="w-full bg-black/40 border border-white/15 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-red-500">
        `,
        onSave: (close) => {
          const j = byId("fJenis").value;
          const title = byId("fJudul").value.trim();
          const date = byId("fTanggal").value.trim();
          if (!title) { alert("Nama kegiatan wajib diisi."); return; }
          if (id) {
            const ref = DATA.program[jenis].find(p => p.id === id);
            Object.assign(ref, { title, date });
            if (j !== jenis) {
              // move across list
              DATA.program[jenis] = DATA.program[jenis].filter(p => p.id !== id);
              DATA.program[j].push(ref);
            }
          } else {
            DATA.program[j].push({ id: uid(), title, date });
          }
          saveData();
          renderProgram();
          close();
        }
      });
    }

    function hapusProgram(id, jenis) {
      if (!confirm("Hapus program ini?")) return;
      DATA.program[jenis] = DATA.program[jenis].filter(p => p.id !== id);
      saveData();
      renderProgram();
    }

    // --- Galeri Actions ---
    function tambahFotoGaleri(files) {
      const tasks = Array.from(files).slice(0, 20).map(file => fileToDataURL(file));
      Promise.all(tasks).then(urls => {
        DATA.galeri.push(...urls);
        saveData();
        renderGaleri();
      });
    }
    function hapusFotoGaleri(idx) {
      if (!confirm("Hapus foto ini?")) return;
      DATA.galeri.splice(idx,1);
      saveData();
      renderGaleri();
    }

    // --- Dokumen Actions ---
    function tambahDokumen(file) {
      fileToDataURL(file).then(url => {
        DATA.dokumen.push({ id: uid(), name: file.name, size: file.size, dataUrl: url });
        saveData();
        renderDokumen();
      });
    }

    // --- File Utils ---
    function fileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function escapeHtml(str="") {
      return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }

    // --- Gallery Viewer ---
    let viewerIndex = 0;
    function openViewer(idx) {
      if (!DATA.galeri.length) return;
      viewerIndex = idx;
      byId("viewerImg").src = DATA.galeri[viewerIndex];
      byId("viewer").classList.remove("hidden");
      document.body.classList.add("viewer-open");
    }
    function closeViewer() {
      byId("viewer").classList.add("hidden");
      document.body.classList.remove("viewer-open");
    }
    function nextViewer(step=1) {
      if (!DATA.galeri.length) return;
      viewerIndex = (viewerIndex + step + DATA.galeri.length) % DATA.galeri.length;
      byId("viewerImg").src = DATA.galeri[viewerIndex];
    }

    // --- Events Bind ---
    function bindEvents() {
      byId("btnAdmin").addEventListener("click", openAdminModal);
      byId("closeAdminModal").addEventListener("click", closeAdminModal);
      byId("btnAdminBatal").addEventListener("click", closeAdminModal);
      byId("btnAdminMasuk").addEventListener("click", () => {
        const email = byId("adminEmail").value.trim().toLowerCase();
        if (email === ADMIN_EMAIL.toLowerCase()) {
          isAdmin = true;
          localStorage.setItem("admin_demo", "true");
          applyAdminVisibility();
          closeAdminModal();
        } else {
          byId("adminMsg").classList.remove("hidden");
        }
      });
      byId("btnLogout").addEventListener("click", () => {
        isAdmin = false;
        localStorage.removeItem("admin_demo");
        applyAdminVisibility();
      });

      // Logo
      byId("btnUploadLogo").addEventListener("click", () => byId("inputLogo").click());
      byId("inputLogo").addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (!f) return;
        DATA.logo = await fileToDataURL(f);
        saveData(); renderHeader();
      });

      // Cover
      byId("btnUploadCover").addEventListener("click", () => byId("inputCover").click());
      byId("inputCover").addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (!f) return;
        DATA.cover = await fileToDataURL(f);
        saveData(); renderHeader();
      });

      // Pengurus
      byId("btnTambahPengurus").addEventListener("click", () => openPengurusModal());

      // Program
      byId("btnTambahProgram").addEventListener("click", () => openProgramModal(null, "bulanan"));

      // Galeri
      byId("btnTambahFoto").addEventListener("click", () => byId("inputFotoGaleri").click());
      byId("inputFotoGaleri").addEventListener("change", (e) => {
        if (e.target.files.length) tambahFotoGaleri(e.target.files);
      });

      // Dokumen
      byId("btnUploadDok").addEventListener("click", () => byId("inputDokumen").click());
      byId("inputDokumen").addEventListener("change", (e) => {
        const f = e.target.files[0];
        if (f) tambahDokumen(f);
      });

      // Viewer
      byId("viewerClose").addEventListener("click", closeViewer);
      byId("viewerPrev").addEventListener("click", () => nextViewer(-1));
      byId("viewerNext").addEventListener("click", () => nextViewer(1));
      window.addEventListener("keydown", (e) => {
        if (byId("viewer").classList.contains("hidden")) return;
        if (e.key === "Escape") closeViewer();
        if (e.key === "ArrowRight") nextViewer(1);
        if (e.key === "ArrowLeft") nextViewer(-1);
      });
    }

    // --- Init ---
    (function init() {
      byId("year").textContent = new Date().getFullYear();
      bindEvents();
      renderAll();
    })();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96af3c4f41e47855',t:'MTc1NDQ5MDY2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
